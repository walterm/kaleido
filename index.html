<!DOCTYPE 5>
<html>
  <head>
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/ui-lightness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="./css/select2.css">
    <link rel="stylesheet" type="text/css" href="./css/font-awesome-4.1.0/css/font-awesome.css">
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/stub_data.js"></script>
    <script type="text/javascript" src="./js/data_sorting_utils.js"></script>
    <script type="text/javascript" src="./js/filtering.js"></script>
    <script type="text/javascript" src="./js/chosen_v1.1.0/chosen.jquery.js"></script>
    <script type="text/javascript" src="./js/querybuilder.js"></script>
    <script type="text/javascript" src="./js/graphing_functions.js"></script>
    <script type="text/javascript" src="./js/select2.js"></script>
    <style type="text/css">

      .select {
        display: none;
      }

      .display {
        display: block !important;
      }

      .step_2 input, .step_2 select, .step_3 input{
        margin-right: 10px;
      }

      .step_1 label {
        margin-left: 5px;
      }

      i {
        margin-left: 5px;
        font-size: 20px;
      }
    </style>
  </head>
  <body>
  
  <!-- step 0 -->
  <div class="container-fluid">
    <div class="step_1 container-fluid">
      <h3>Step 1: Chart Selection</h3>
      <div class="btn-group chart" data-toggle="buttons">
        <label class="btn btn-primary"><input type="radio" name="chart" value="scatter"/>Scatter Plot</label>
        <label class="btn btn-primary"><input type="radio" name="chart" value="histogram"/>Histogram</label>
        <label class="btn btn-primary"><input type="radio" name="chart" value="pie"/>Pie Chart</label>
        <label class="btn btn-primary"><input type="radio" name="chart" value="line"/>Line Chart</label>
        <label class="btn btn-primary"><input type="radio" name="chart" value="area"/>Area Chart</label>
        <label class="btn btn-primary"><input type="radio" name="chart" value="polar"/>Polar Graph</label>
        <label class="btn btn-primary"><input type="radio" name="chart" value="heatmap"/>Heatmap</label>
      </div>
    </div>

    <div class="step_2 container-fluid select">
      <h3>Step 2: Slot Selection</h3>

      <div class="scatter_select container-fluid select">
        <div class="scatter_options row">
          <label>X Axis: </label> <input type="text" name="x_axis" class="quant"/>
          <label>Y Axis: </label> <input type="text" name="y_axis" class="quant"/>
          <label>Color: </label> <input type="text" name="color" class="cat"/>
          <label>Size: </label> <input type="text" name="size" class="quant"/>
          <!-- <label>Shape: </label> <input type="text" name="shape" class="cat"/> -->
        </div>
      </div>
      <div class="histogram_select select">
        <div class="histogram_options">
          <label>X Axis: </label> <input type="text" name="histogram_x_axis" class="quant cat group"/>
          <label>Height: </label> <input type="text" name="histogram_height" class="quant aggregate"/>
          <select for="histogram_height" class="aggregate">
            <option value="sum">Sum</option>
            <option value="avg">Average</option>
            <option value="max">Max</option>
            <option value="min">Min</option>
            <option value="count">Count</option>
          </select>
          <label>Stacks: </label> <input type="text" name="stacks" class="cat"/>
        </div>
      </div>
      <div class="pie_select select">
        <div class="pie_options">
          <label>Segment: </label> <input type="text" name="pie_segment" class="quant cat group"/>
          <label>Area: </label> <input type="text" name="pie_area" class="quant"/>
          <select for="pie_area" class="aggregate">
            <option value="sum">Sum</option>
            <option value="avg">Average</option>
            <option value="max">Max</option>
            <option value="min">Min</option>
            <option value="count">Count</option>
          </select>
        </div>
      </div>
      <div class="line_select select">
        <div class="line_options">
          <label>X Axis: </label> <input type="text" name="line_x_axis" class="quant group"/>
          <label>Y Axis: </label> <input type="text" name="line_y_axis" class="quant aggregate"/>
          <select for="line_y_axis" class="aggregate">
            <option value="sum">Sum</option>
            <option value="avg">Average</option>
            <option value="max">Max</option>
            <option value="min">Min</option>
            <option value="count">Count</option>
          </select>
        </div>
      </div>
      <div class="area_select select">
        <div class="area_options">
          <label>X Axis: </label> <input type="text" name="area_x_axis" class="quant group"/>
          <label>Y Axis: </label> <input type="text" name="area_y_axis" class="quant aggregate"/>
          <select for="area_y_axis" class="aggregate">
            <option value="sum">Sum</option>
            <option value="avg">Average</option>
            <option value="max">Max</option>
            <option value="min">Min</option>
            <option value="count">Count</option>
          </select>
          <label>Stacks: </label> <input type="text" name="stacks" class="cat"/>
        </div>
      </div>
      <div class="polar_select select">
        <div class="polar_options">
          <label>Radius: </label> <input type="text" name="radius" class="quant cat"/>
          <label>Angle: </label> <input type="text" name="angle" class="cat"/>
          <label>Color: </label> <input type="text" name="color" class="cat"/>
          <label>Size: </label> <input type="text" name="size" class="quant"/>
        </div>
      </div>
      <div class="heatmap_select select">
        <div class="heatmap_options">
          <label>X Axis: </label> <input type="text" name="x_axis" class="quant cat group"/>
          <label>Y Axis: </label> <input type="text" name="y_axis" class="quant cat group"/>
          <label>Color: </label> <input type="text" name="heatmap_color" class="quant aggregate"/>
          <select for="heatmap_color" class="aggregate">
            <option value="sum">Sum</option>
            <option value="avg">Average</option>
            <option value="max">Max</option>
            <option value="min">Min</option>
            <option value="count">Count</option>
          </select>
        </div>
      </div>

      <div class="step_3 select">
        <h3>Step 3: Filtering</h3>
        <input type="text" name="filter_field" placeholder="Enter filter field..." class="filter_field"/>
        <div class="filters"></div><br/>
        <button class="graph btn btn-danger">GRAPH IT!</button>
      </div>

    </div>
  </div>

  <script type="text/javascript">
  var builder;
  $(function(){
    builder = new QueryBuilder({namespace: "xgen.jira", seed: "mongodb://localhost:27017"});
    var graph = "";
    

    $(".btn-group").click(function(event){
      if(graph !== ""){
        $("." + graph + "_select").hide();
      }
      $(".step_2").show();
      graph = $(event.target).find("input").val();
      
      
      $("." + graph + "_select").fadeIn("fast");
    });

    // $("input[type=radio]").each(function(index, elem){
    //   $(elem).click(function(evt){
    //     var val = $(this).val();
    //     graph = val;
    //     $(".display").removeClass("display");
    //     $("." + val + "_select").add(".step_2").addClass("display");
    //   });
    // });

    $(".quant").add(".cat").each(function(index, elem){
      var fields = textFields(elem)();
      $(elem).autocomplete({
        source: fields,
        select: function(event, ui){
          var empty = $("." + graph + "_options").find("input").filter(function(index, elem){
            return $(elem).val().length === 0;
          });
          if(empty.length === 0){
            $(".step_3").addClass("display");
            $(".step_3").removeClass("select");
          } 
        }
      });
    });

    $(".aggregate").each(function(index, elem){
      $(elem).change(function(event){
        console.log("changed", $(elem).val());

        if( $(elem).val() === "count"){
          console.log("input[name=" + $(elem).attr("for") + "]");
          $("input[name=" + $(elem).attr("for") + "]").hide();
        }else $("input[name=" + $(elem).attr("for") + "]").show();
      });
    });
    var allFields = findBoth(data);
    $(".filter_field").autocomplete({
      source: allFields,
      select: function(event, ui){

        var field = $(".filter_field").val();
        $(".filter_field").val("");
        addFilter(field);
        return false;
      }
    });

    $(".graph").click(function(evt){
      var options = parseOptions();
      for(match_option in options.match){
        builder.match(match_option, options.match[match_option]);
      }

      for(group_option in options.group){
        builder.group(group_option, options.group[group_option]);
      }

      for(agg_option in options.agg){
        // ???
      }


    });



  });

  </script>

  </body>
</html>
